---
import '../styles/global.css'
import Side from "../components/Side.astro";
import Toc from '../components/Toc';
import Footer from '../components/Footer.astro';

const { pageTitle, linkType } = Astro.props
---

<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{pageTitle}</title>
</head>
<body>
    <Side />
    <h1>{pageTitle}</h1>
    <main role="main">
        <slot />
    </main>
    <Toc client:load />
    <Footer />
</body>

<script>
    let mouseOutTimeout;

var links = document.links;

for (var i = 0; i < links.length; i++) {
    if (links[i].hostname !== window.location.hostname) {
        links[i].classList.add("external-link");
        links[i].textContent += ' â†—';

        links[i].addEventListener('click', function(event) {
            event.preventDefault();
            window.open(this.href, 'popupWindow', 'width=800,height=600,scrollbars=yes,resizable=yes');
        });
    } else {
        // Internal link hover detection
        links[i].addEventListener('mouseover', (event) => {
            clearTimeout(mouseOutTimeout); // Cancel any pending mouseout
            const link = event.currentTarget; // Use currentTarget to ensure it's the <a> element
            const url = new URL(link.getAttribute('href'), window.location.origin);
            const nodeId = url.pathname.split('/').pop();

            console.log("Hovered link URL:", url.href);
            console.log("Extracted node ID:", nodeId);

            if (window.setHoveredNode) {
                window.setHoveredNode(nodeId);
            }
        });

        links[i].addEventListener('mouseout', () => {
            mouseOutTimeout = setTimeout(() => {
                if (window.setHoveredNode) {
                    window.setHoveredNode(null);
                }
            }, 200); // Adjust delay as needed
        });
    }
}
</script>
<script>
    import "../scripts/baseLayout";
</script>
</html>