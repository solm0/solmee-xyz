---
import Modal from "./Modal.astro"
import SearchBar from "./SearchBar.astro"
---

<div class="nav-links side">
    <a class="notes" href="/notes/">Notes</a>
    <a class="logbooks" href="/logbooks/">Logbooks</a>
    <a class="works" href="/works/">Works</a>
    <br>
    <a href="/newsletter/">Newsletter</a>
    <a href="/cv/">CV</a>
    <br>
    <a href="/tags/">tags</a>
    <a href="/rss.xml" title="RSS Feed" target="_blank" rel="noopener noreferrer">RSS</a>
    
    <Modal id="dialog" open="Search">
        <main class="dialog-main" slot="main">
            <SearchBar />
        </main>
        <button class="close-button" slot="close">Close</button>
    </Modal>
    
    <Modal id="pagefind" open="Search2">
        <main class="dialog-main" slot="main">

            <div id="search"></div>
            <script>
                import { PagefindUI } from "@pagefind/default-ui";
                window.addEventListener("DOMContentLoaded", () => {
                new PagefindUI({
                    element: "#search",
                    showSubResults: true,
                    autofocus: true,
                });
                const el = document.querySelector(".pagefind-ui");
                const input = el?.querySelector<HTMLInputElement>(`input[type="text"]`);
                const clearButton = el?.querySelector(".pagefind-ui__search-clear");
                // Check if the current URL has any query params
                const url = new URL(window.location.href);
                const params = new URLSearchParams(url.search);
                const query = params.get("q");

                // If query exists on page load
                if (query && input) {
                    input.value = query;
                    input.dispatchEvent(new Event("input", { bubbles: true }));
                }
                input?.addEventListener("input", (e) => {
                    const input = e.target as HTMLInputElement;
                    const url = new URL(window.location.href);
                    const params = new URLSearchParams(url.search);
                    params.set("q", input.value);
                    window.history.replaceState({}, "", `${url.pathname}?${params}`);
                });
                clearButton?.addEventListener("click", () => {
                    const url = new URL(window.location.href);
                    const params = new URLSearchParams(url.search);
                    params.delete("q");
                    window.history.replaceState({}, "", `${url.pathname}`);
                });
                });
            </script>
        </main>
        <button class="close-button" slot="close">Close</button>
    </Modal>
</div>